<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="bt">RougeGad</title>
</head>

<body>
    <div style="height: 600px;width: 300px;background-color:antiquewhite;float: left;text-align: center;">
        <div style="background-color:rgb(255, 243, 80);">
            <br><b id="tileName">åœ°å›¾å</b><br><br>
        </div>
        <div style="background-color:coral;height: 200px;">
            ä¿¡æ¯åˆ—è¡¨
            <p id="ZuoBiao"></p>
            <p id="MoveInfo"></p>
        </div>
        <div style="background-color:rgb(255, 243, 80);height: 150px;width: 150px;float: left;">
            <canvas height="150" width="150" id="HomePath"></canvas>
        </div>

        <div style="background-color:rgb(173, 255, 80);height: 150px;width: 150px;float: left;">
            <div style="height: 50px;width: 50px;background-color: aquamarine;float: left;"> </div>
            <div style="height: 50px;width: 50px;float: left;">
                <button style="height: 50px;width: 50px;" id="Up" onclick="Up()">â†‘</button></div>
            <div style="height: 50px;width: 50px;background-color: aquamarine;float: left;"></div>
            <div style="height: 50px;width: 50px;float: left;">
                <button style="height: 50px;width: 50px;" id="Left" onclick="Left()">â†</button></div>
            <div style="height: 50px;width: 50px;background-color: aquamarine;float: left;"></div>
            <div style="height: 50px;width: 50px;float: left;">
                <button style="height: 50px;width: 50px;" id="Right" onclick="Right()">â†’</button></div>
            <div style="height: 50px;width: 50px;background-color: aquamarine;float: left;"></div>
            <div style="height: 50px;width: 50px;float: left;">
                <button style="height: 50px;width: 50px;" id="Down" onclick="Down()">â†“</button></div>
            <div style="height: 50px;width: 50px;background-color: aquamarine;float: left;"></div>
        </div>
        <div style="height: 150px;width: 150px;float: left;background-color:rgb(145, 190, 241);">
            <div style="height: 50px;width: 50px;background-color: aquamarine;float: left;">
                <button style="height: 50px;width: 50px;" onclick="ClearInfo()">é‡ç½®</button>
            </div>
            <div style="height: 50px;width: 50px;float: left;"></div>
            <div style="height: 50px;width: 50px;background-color: aquamarine;float: left;"></div>
            <div style="height: 50px;width: 50px;float: left;"></div>
            <div style="height: 50px;width: 50px;background-color: aquamarine;float: left;"></div>
            <div style="height: 50px;width: 50px;float: left;"></div>
            <div style="height: 50px;width: 50px;background-color: aquamarine;float: left;"></div>
            <div style="height: 50px;width: 50px;float: left;"></div>
            <div style="height: 50px;width: 50px;background-color: aquamarine;float: left;"></div>
        </div>
        <div style="height: 150px;width: 150px;float: left;background-color:rgb(236, 112, 112);">
            é”®ç›˜æŒ‰é”®æ£€æµ‹<br>ç¦æ­¢æ–‡å­—é€‰æ‹©
            <p draggable="true" id="yaoGan">ğŸ‘‰çœŸçš„æ˜¯æ‘‡æ†</p>
            ç§»åŠ¨ç«¯ä¸èƒ½ç”¨<br>å®£å¸ƒå¤±è´¥
        </div>

    </div>

    <div style="height: 600px;width: 300px;background-color:antiquewhite;float: left;text-align: center;">
        <div style="height: 300px;width: 300px;float: left;">
            <canvas height="300" width="300" id="ceshi"></canvas>
        </div>
        <div style="height: 300px;width: 300px;float: left;background-color: rgb(78, 245, 106);">
            <canvas height="300" width="300" id="ceshi"></canvas>
        </div>
    </div>

    <div style="height: 600px;width: 300px;background-color:aquamarine;float: left;text-align: center;">
    </div>
</body>
<script>
    //åŠ¨æ€ç½‘é¡µæ ‡é¢˜
    var startChange = setInterval(activeTitle, 3000)
    var i = new Boolean;
    function activeTitle() {
        if (i) { document.getElementById("bt").innerText = "Made By Gadsss"; i = false }
        else { document.getElementById("bt").innerText = "RougeGad"; i = true }
    }
    //åœ°å›¾æ•°æ®
    var tiles = new Array();var ditu, jiditu, x, y, home;//ç¬¬ä¸€æ¬¡æ‰“å¼€é˜²bug
    if (!localStorage.tiles) { ClearInfo() }//åˆå§‹åŒ–åœ°å›¾ä¿¡æ¯
    ditu = localStorage.tiles.split(","); jiditu = 0;//å°†åœ°å›¾ä¿¡æ¯ä¿å­˜åˆ°äºŒç»´æ•°ç»„
    for (let i = 0; i < localStorage.mapL; i++) {
        tiles[i] = new Array();
        for (let o = 0; o < localStorage.mapR; o++) {
            tiles[i][o] = ditu[jiditu]; jiditu++;
        }
    }
    //è¿™ä¸ªåæ ‡ç³»å‘ä¸‹æ˜¯Y+ï¼Œå‘å³æ˜¯X+
    x = +localStorage.x; y = +localStorage.y;//å½•å…¥è‡ªå·±åœ¨åœ°å›¾ä¸­çš„ä½ç½®
    home = [parseInt(localStorage.home.split(',')[0]), parseInt(localStorage.home.split(',')[1])];//å½•å…¥å®¶çš„ä½ç½®
    //å¼€å§‹
    window.onload = function Start() {//æ ¹æ®åœ°å›¾å¢åŠ çš„è¡Œåˆ—é‡ç»˜åœ°å›¾
        ReShow();
    }
    //åˆ·æ–°é¡µé¢å†…å®¹å¹¶ä¿å­˜ï¼Œä»¥åŠä¸€äº›æ•°æ®æ˜¾ç¤º
    function ReShow() {
        document.getElementById("tileName").innerHTML = tiles[x][y]; Line2Home();
        localStorage.x = x; localStorage.y = y;
        document.getElementById("ZuoBiao").innerHTML = x + "," + y;
        DrawMap(tiles);
    }
    //ç»˜åˆ¶ä¸»è§’åˆ°å®¶çš„è¿çº¿æŒ‡ç¤ºå™¨
    function Line2Home() {
        //ç”»å›¾ï¼Œæ³¨æ„canvasçš„åæ ‡ç³»
        var lX = 75 - (x - home[0]) * 10; var lY = 75 - (y - home[1]) * 10;//å°„çº¿çš„æ–¹å‘
        var hjc = document.getElementById("HomePath");
        var hjLine = hjc.getContext("2d");
        hjLine.strokeStyle = "red"; hjLine.fillStyle = "red";
        hjLine.clearRect(0, 0, 150, 150);//æ¸…ç†canvas
        hjLine.beginPath();//åˆ›å»ºæˆ–é‡ç½®è·¯å¾„
        hjLine.arc(75, 75, 70, 0, 2 * Math.PI);
        hjLine.stroke(); //ç”»å¤–é¢çš„å¤§åœ† 
        hjLine.clip();//åˆ‡æ‰å¤§åœ†ä»¥å¤–çš„éƒ¨åˆ†
        hjLine.beginPath();
        hjLine.moveTo(75, 75);
        hjLine.lineTo(lX, lY);
        hjLine.stroke(); //ç”»äººåˆ°å®¶çš„è¿çº¿
        hjLine.beginPath();
        hjLine.arc(lX, lY, 5, 0, 2 * Math.PI); //èµ·ç‚¹åæ ‡ï¼ŒåŠå¾„ï¼Œèµ·å§‹è§’ï¼Œç»“æŸè§’
        hjLine.stroke(); //ç”»æŒ‡ç¤ºå®¶çš„åœ†
        hjLine.beginPath();
        hjLine.arc(75, 75, 3, 0, 2 * Math.PI);
        hjLine.fill(); //ç”»ä»£è¡¨è‡ªå·±çš„å¡«å……åœ†   
    }
    //ç”¨å››åˆ†æ³•éšæœºåœ°å›¾
    function StartRanMap(x, y, midu) {
        //xæ˜¯åœ°å›¾å®½ï¼Œyæ˜¯é«˜ï¼Œmiduæ˜¯å¯†åº¦ï¼ˆå°æ•°
        //xyå¾—æ˜¯å¶æ•°ï¼Œä¸æƒ³å†™å¥‡æ•°éƒ¨åˆ†äº†ï¼Œæœ‰ä»€ä¹ˆå¿…è¦å‘¢
        var num = y / 2; var range = x / 2; var midus = [4];
        //ç”Ÿæˆä¸€ä¸ªå››ä½çš„äºŒè¿›åˆ¶æ•°ç»„æ§åˆ¶å¯†åº¦çš„éšæœº
        var way = Math.floor(Math.random() * 16).toString(2).split(""); var wl = 4 - way.length;
        for (let i = 0; i < wl; i++) {
            way.unshift('0');
        }
        for (let i = 0; i < 4; i++) {
            if (way[i] == 1) { midus[i] = (midu + 0.1) * num * range }
            if (way[i] == 0) { midus[i] = (midu - 0.1) * num * range }
        }
        //å¥½åƒå¾—åŠ ä¸Šreturnæ‰èƒ½è®©è°ƒç”¨çš„æ–¹æ³•çš„è¿”å›å€¼å†è¿”å›ï¼Œå¥½ç¬¨å•Š
        return RandomMap(num, range, midus);
    }
    function RandomMap(num, range, midus) {
        //å®šä¹‰äºŒç»´æ•°ç»„
        var map = new Array();
        for (let i = 0; i < 2 * range; i++) {
            map[i] = new Array();
            for (let o = 0; o < 2 * num; o++) {
                map[i][o] = "æ°´";
            }
        }
        //å¡«å……è¾¹ç•Œ
        //++++è¿™é‡Œå¯ä»¥åè½¬æ•°ç»„ï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆå¿…è¦äº†
        var zuoshang = chooseWant(num, range, midus[0]);
        for (let i = 0; i < num; i++) {
            map[range - 1 - zuoshang[i]][i] = "é™†åœ°";
        }
        var youshang = chooseWant(num, range, midus[1]);
        for (let i = 0; i < num; i++) {
            map[range + youshang[i]][i] = "é™†åœ°";
        }
        var zuoxia = chooseWant(num, range, midus[2]);
        for (let i = 0; i < num; i++) {
            map[range - 1 - zuoxia[num - 1 - i]][i + num] = "é™†åœ°";
        }
        var youxia = chooseWant(num, range, midus[3]);
        for (let i = 0; i < num; i++) {
            map[range + youxia[num - 1 - i]][i + num] = "é™†åœ°";
        }
        //å¡«å……ä¸­é—´å€¼
        for (let o = 0; o < 2 * num; o++) {
            var tc = 0;
            for (let i = 0; i < 2 * range; i++) {
                if (map[i][o] == "é™†åœ°" & tc == 0) { tc = 1 }
                else if (map[i][o] == "é™†åœ°" & tc == 1) { tc = 0 }
                if (tc == 1) { map[i][o] = "é™†åœ°" }
            }
        }
        return map;
    }
    //ç»˜åˆ¶åœ°å›¾
    function DrawMap(map) {
        var hjLine = document.getElementById("ceshi").getContext("2d"); hjLine.clearRect(0, 0, map.length * 6, map[0].length * 6);
        for (let i = 0; i < map.length; i++) {
            for (let o = 0; o < map[0].length; o++) {
                if (map[i][o] == "é™†åœ°") {
                    hjLine.beginPath(); hjLine.strokeStyle = "#ff9900";
                    hjLine.arc(6 * i + 3, 6 * o + 3, 3, 0, 2 * Math.PI);//ç”»é™†åœ°
                    hjLine.stroke();
                } else if (map[i][o] == "æ°´") {
                    hjLine.beginPath(); hjLine.strokeStyle = "#0099ff";
                    hjLine.arc(6 * i + 3, 6 * o + 3, 3, 0, 2 * Math.PI);//ç”»æ°´
                    hjLine.stroke();
                } else if (map[i][o] == "å®¶") {
                    hjLine.beginPath(); hjLine.strokeStyle = "#ff0000";
                    hjLine.arc(6 * i + 3, 6 * o + 3, 3, 0, 2 * Math.PI);//ç”»å®¶
                    hjLine.stroke();
                }
            }
        }
        hjLine.beginPath(); hjLine.fillStyle = "#000000";
        hjLine.arc(6 * x + 3, 6 * y + 3, 3, 0, 2 * Math.PI);//ç”»äºº
        hjLine.fill();
    }
    //åˆå¹¶åœ°å›¾
    //ä¸€ä¸ªå°åœ°å›¾ï¼Œä¸€ä¸ªå¤§åœ°å›¾ï¼Œä¸€ä¸ªå¼•å¯¼ç‚¹ï¼ˆå·¦ä¸Š
    function MergeMap(sMap, lMap, Point) {
        //æ ¹æ®å¤§åœ°å›¾çš„å®½é«˜è¿›è¡Œï¼Œå› æ­¤å°†å°åœ°å›¾ä¼šå¤šå‡ºæ¥çš„ä½ç½®ä¸¢å¼ƒ
        if (sMap.length + Point[0] > lMap.length) { x = lMap.length - Point[0] } else { x = sMap.length }
        if (sMap[0].length + Point[1] > lMap[0].length) { y = lMap.length - Point[1] } else { y = sMap.length }
        //å°†å°åœ°å›¾çš„0ï¼Œ0ç‚¹ä»å¤§åœ°å›¾çš„å¼•å¯¼ç‚¹å¼€å§‹é‡å åˆ°å¤§åœ°å›¾
        for (let i = 0; i < x; i++) {
            for (let o = 0; o < y; o++) {
                if (sMap[i][o] == "é™†åœ°") { lMap[i + Point[0]][o + Point[1]] = sMap[i][o] }
            }
        }
        return lMap;
    }
    function RanElement() {
        //++++åœ¨åœ°å›¾ä¸Šäº§ç”Ÿå„ç§å…ƒç´ 
        //åˆ†åˆ—å¥½å±‚çº§
        //ä¸ç”¨ç®¡å®¶çš„ä½ç½®
    }
    function CreateMap() {
        //++++æ”¹æˆå¤–éƒ¨æ§åˆ¶ï¼Œè¿˜æœ‰å°æ¿å—æ•°é‡ï¼Œæ³¨æ„å¥‡å¶
        var x = 50; var y = 50;//ç¡®å®šå¤§åœ°å›¾çš„ç‰ˆå—å¤§å°ï¼Œå»ºç«‹æ•°ç»„
        var mainMap = new Array();
        for (let i = 0; i < x; i++) {
            mainMap[i] = new Array();
            for (let o = 0; o < y; o++) {
                mainMap[i][o] = "æ°´";
            }
        }
        var times = 3;//ç¡®å®šè¦æœ‰å¤šå°‘ä¸ªæ¿å—ï¼Œå¤šæ¬¡å¾ªç¯å°†å°æ¿å—åµŒå…¥åˆ°å¤§æ¿å—
        //++++å†å¥½ä¸€ç‚¹å°±æ˜¯ç»™å‡ºå¤§åœ°å›¾å¯†åº¦ï¼Œè®¡ç®—å‡ºå°åœ°å›¾çš„ç‰ˆå—å¤§å°å’Œå¯†åº¦ï¼Œæ³¨æ„å¥‡å¶
        //ä¿å­˜å‡ ä¸ªéšæœºç‚¹
        var points = new Array();
        for (let u = 0; u < times; u++) {
            points[u] = new Array();
            points[u] = Ran1point(x * 0.8, y * 0.8);//é™åˆ¶ä¸€ä¸‹èŒƒå›´ï¼Œä»¥å…æœ‰äº†åœ°å›¾å´çœ‹ä¸åˆ°
        }
        //++++è®¡ç®—å°æ¿å—å¤§å°
        //++++å…¶å®å¯ä»¥ç›´æ¥ç”¨éšæœºæ•°ï¼Œç„¶åæ ¹æ®å¯†åº¦ç­›é€‰åˆé€‚çš„åœ°å›¾è¿›è¡Œç»˜åˆ¶
        for (let i = 0; i < times; i++) {
            mainMap = MergeMap(StartRanMap(20, 20, 0.6), mainMap, points[i]);
        }
        //++++æ·»åŠ åœ°å›¾å…ƒç´ 
        //RanElement()
        //æ·»åŠ å®¶çš„ä½ç½®
        var homepoint = Ran1point(x, y);
        while (mainMap[homepoint[0]][homepoint[1]] != "é™†åœ°") {
            homepoint = Ran1point(x, y);
        }
        mainMap[homepoint[0]][homepoint[1]] = "å®¶";
        //ç»˜åˆ¶åœ°å›¾ï¼Œä¿å­˜å…ƒç´ 
        DrawMap(mainMap);
        localStorage.tiles = mainMap; localStorage.home = homepoint;
        localStorage.x = homepoint[0]; localStorage.y = homepoint[1];
        localStorage.mapL = y; localStorage.mapR = x;
        //å¦‚æœè¦ä¿®æ”¹æ¥å£ï¼Œå¾—æŠŠè¿™å‡ ä¸ªéƒ½åŠ ä¸Š
    }
    //ç”Ÿæˆä¸€ä¸ªåœ¨èŒƒå›´å†…çš„ç‚¹
    function Ran1point(num, range) {
        return [Math.floor(Math.random() * range), Math.floor(Math.random() * num)]
    }
    //åœ¨0~(range-1)èŒƒå›´å†…ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸ºnumçš„æ•°ç»„ï¼Œå¹¶ç”±å°åˆ°å¤§æ’åˆ—ï¼Œè‹¥è¦ç”±å¤§åˆ°å°å¯ä»¥åè½¬æ•°ç»„
    function RanOlderNum(num, range) {
        var nums = [num];
        for (let i = 0; i < num; i++) {
            nums[i] = Math.floor(Math.random() * range);
        }
        for (let i = num; i > 0; i--) {
            for (let j = 0; j < i; j++) {
                if (nums[j] > nums[j + 1]) {
                    var temp = nums[j];
                    nums[j] = nums[j + 1];
                    nums[j + 1] = temp;
                }
            }
        }
        return nums;
    }
    //æ£€æµ‹æ•°å€¼æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œè¿”å›æ»¡è¶³æ¡ä»¶çš„æ•°ç»„
    //++++è°ƒèŠ‚ä¸€ä¸‹ç­›é€‰ï¼Œè®©è¾¹ç•Œä¸å¹³ï¼Œæ£€æµ‹æœ€å¤§æœ€å°å€¼å°±è¡Œ
    function chooseWant(num, range, qiwang) {
        //è·å–ä¸€ä¸ªéœ€æ±‚çš„å†’æ³¡æ•°ç»„
        var cho = RanOlderNum(num, range); var tot = 0;
        for (let i = 0; i < num; i++) {
            tot += cho[i];
        }
        //æ£€æµ‹æ•°ç»„ï¼ˆé™†åœ°è¾¹ç•Œæ‰€å åœ°å›¾çš„æ¯”ä¾‹
        //++++è¿™é‡Œä½å¯†åº¦æ£€æµ‹å¥½åƒä¼šä¸ç”Ÿæ•ˆ
        if (num * range * 2 > qiwang) {
            while (tot < qiwang) {
                cho = RanOlderNum(num, range); tot = 0;
                for (let i = 0; i < num; i++) {
                    tot += cho[i];
                }
            }
        } else {
            while (tot > qiwang) {
                cho = RanOlderNum(num, range); tot = 0;
                for (let i = 0; i < num; i++) {
                    tot += cho[i];
                }
            }
        }
        return cho;
    }
    //é‡ç½®ä¿¡æ¯
    function ClearInfo() {
        CreateMap();
        ditu = localStorage.tiles.split(","); jiditu = 0;//å°†åœ°å›¾ä¿¡æ¯ä¿å­˜åˆ°äºŒç»´æ•°ç»„
        for (let i = 0; i < localStorage.mapL; i++) {
            tiles[i] = new Array();//ç¬¬ä¸€æ¬¡æ‰“å¼€é˜²bug
            for (let o = 0; o < localStorage.mapR; o++) {
                tiles[i][o] = ditu[jiditu]; jiditu++;
            }
        }
        x = +localStorage.x; y = +localStorage.y; home = [x, y];
        ReShow();
    }
    //æ–¹å‘æŒ‰é’®
    function Up() {
        if (tiles[x][y - 1] == "æ°´") {
            document.getElementById("MoveInfo").innerHTML = "å‰é¢æ˜¯æ°´ï¼Œä¸èƒ½å‰è¿›äº†"
        } else if (y - 1 == -1) {
            document.getElementById("MoveInfo").innerHTML = "åˆ°è¾¾äº†åœ°å›¾è¾¹ç•Œ";
        } else { y--; document.getElementById("MoveInfo").innerHTML = "å‘åŒ—å‰è¿›äº†ä¸€æ ¼"; ReShow(); }
    }
    function Down() {
        if (tiles[x][y + 1] == "æ°´") {
            document.getElementById("MoveInfo").innerHTML = "å‰é¢æ˜¯æ°´ï¼Œä¸èƒ½å‰è¿›äº†"
        } else if (y + 1 == tiles[0].length) {
            document.getElementById("MoveInfo").innerHTML = "åˆ°è¾¾äº†åœ°å›¾è¾¹ç•Œ";
        } else { y++; document.getElementById("MoveInfo").innerHTML = "å‘å—å‰è¿›äº†ä¸€æ ¼"; ReShow(); }
    }
    function Left() {
        if (x - 1 === -1) {
            document.getElementById("MoveInfo").innerHTML = "åˆ°è¾¾äº†åœ°å›¾è¾¹ç•Œ";
        } else if (tiles[x - 1][y] == "æ°´") {
            document.getElementById("MoveInfo").innerHTML = "å‰é¢æ˜¯æ°´ï¼Œä¸èƒ½å‰è¿›äº†"
        } else { x--; document.getElementById("MoveInfo").innerHTML = "å‘è¥¿å‰è¿›äº†ä¸€æ ¼"; ReShow(); }
    }
    function Right() {
        if (x + 1 == tiles.length) {
            document.getElementById("MoveInfo").innerHTML = "åˆ°è¾¾äº†åœ°å›¾è¾¹ç•Œ";
        } else if (tiles[x + 1][y] == "æ°´") {
            document.getElementById("MoveInfo").innerHTML = "å‰é¢æ˜¯æ°´ï¼Œä¸èƒ½å‰è¿›äº†"
        } else { x++; document.getElementById("MoveInfo").innerHTML = "å‘ä¸œå‰è¿›äº†ä¸€æ ¼"; ReShow(); }
    }
    //æ‘‡æ†æ£€æµ‹
    //è¿™ä¸ªåæ ‡ç³»ä¹Ÿæ˜¯å¥‡æ€ªçš„
    var ygX = 0; var ygY = 0;
    document.getElementById("yaoGan").ondragstart = function getPos(e) {
        ygX = e.clientX; ygY = e.clientY; document.getElementById("MoveInfo").innerHTML = ygX + "," + ygY;
    }
    document.getElementById("yaoGan").ondrag = function showPos(e) {
        document.getElementById("MoveInfo").innerHTML = (e.clientX - ygX) + "," + (e.clientY - ygY);
    }
</script>

</html>